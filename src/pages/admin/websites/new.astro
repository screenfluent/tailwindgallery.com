---
import { db, Websites } from 'astro:db';
import { actions } from 'astro:actions';
import AdminLayout from '../../../layouts/AdminLayout.astro';

// Define the form action
export const addWebsite = actions({
  async POST({ request }) {
    const formData = await request.formData();
    const url = formData.get('url') as string;
    const title = formData.get('title') as string;
    const description = formData.get('description') as string;
    const showcaseType = formData.get('showcaseType') as string;

    // Add the website to the database
    await db.insert(Websites).values({
      url,
      title,
      description,
      showcaseType,
      usesTailwind: true,
      submittedBy: 1, // TODO: Get from session
      createdAt: new Date(),
      updatedAt: new Date(),
      status: 'pending'
    });

    // Redirect to the websites list
    return {
      success: true,
      redirect: '/admin/websites'
    };
  }
});
---

<AdminLayout title="Add New Website">
  <form method="POST" action={addWebsite} class="max-w-2xl bg-white rounded-xl border border-gray-200 p-6">
    <div class="space-y-6">
      <!-- URL -->
      <div>
        <label for="url" class="block text-sm font-medium text-gray-700">Website URL</label>
        <div class="mt-1">
          <input
            type="url"
            name="url"
            id="url"
            required
            placeholder="https://example.com"
            class="block w-full rounded-lg border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500"
          />
        </div>
        <p class="mt-1 text-xs text-gray-500">Enter the full URL including https://</p>
      </div>

      <!-- Title -->
      <div>
        <label for="title" class="block text-sm font-medium text-gray-700">Title</label>
        <div class="mt-1">
          <input
            type="text"
            name="title"
            id="title"
            required
            placeholder="My Awesome Website"
            class="block w-full rounded-lg border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500"
          />
        </div>
      </div>

      <!-- Description -->
      <div>
        <label for="description" class="block text-sm font-medium text-gray-700">Description</label>
        <div class="mt-1">
          <textarea
            name="description"
            id="description"
            rows="3"
            required
            placeholder="A brief description of the website..."
            class="block w-full rounded-lg border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500"
          ></textarea>
        </div>
      </div>

      <!-- Showcase Type -->
      <div>
        <label for="showcaseType" class="block text-sm font-medium text-gray-700">Showcase Type</label>
        <div class="mt-1">
          <select
            name="showcaseType"
            id="showcaseType"
            required
            class="block w-full rounded-lg border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500"
          >
            <option value="">Select a type</option>
            <option value="portfolio">Portfolio</option>
            <option value="saas">SaaS</option>
            <option value="product">Product</option>
            <option value="media">Media</option>
            <option value="marketplace">Marketplace</option>
            <option value="developer-tool">Developer Tool</option>
            <option value="platform">Platform</option>
            <option value="other">Other</option>
          </select>
        </div>
      </div>

      <!-- Submit Button -->
      <div class="pt-2">
        <button
          type="submit"
          class="w-full flex justify-center py-2 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500"
        >
          Add Website
        </button>
      </div>
    </div>
  </form>
</AdminLayout> 